{% extends 'store/base.html' %}
{% load humanize %}

{% block title %}Chi tiết đơn hàng #{{ order.id }} - Tiệm sách Urahara{% endblock %}

{% block content %}
<h2 class="mb-4"><i class="bi bi-receipt"></i> Chi tiết đơn hàng #{{ order.id }}</h2>

<div class="row">
    <div class="col-md-8">
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Sản phẩm</h5>
            </div>
            <div class="card-body">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Sách</th>
                            <th>Số lượng</th>
                            <th>Giá</th>
                            <th>Thành tiền</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in order.items.all %}
                            <tr>
                                <td>
                                    <a href="{% url 'book_detail' item.book.slug %}" class="text-decoration-none">
                                        {{ item.book.title }}
                                    </a>
                                    <br>
                                    <small class="text-muted">Tác giả: {{ item.book.author }}</small>
                                </td>
                                <td>{{ item.quantity }}</td>
                                <td>{{ item.price|floatformat:0|intcomma }} đ</td>
                                <td class="fw-bold">{{ item.get_total_price|floatformat:0|intcomma }} đ</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="3" class="text-end"><strong>Tổng tiền:</strong></td>
                            <td class="fw-bold text-danger fs-5">{{ order.total_price|floatformat:0|intcomma }} đ</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0">Thông tin đơn hàng</h5>
            </div>
            <div class="card-body">
                <p><strong>Trạng thái:</strong><br>
                    {% if order.status == 'pending' %}
                        <span class="badge bg-warning">{{ order.get_status_display }}</span>
                    {% elif order.status == 'completed' %}
                        <span class="badge bg-success">{{ order.get_status_display }}</span>
                    {% elif order.status == 'cancelled' %}
                        <span class="badge bg-danger">{{ order.get_status_display }}</span>
                    {% endif %}
                </p>
                <p><strong>Phương thức thanh toán:</strong><br>
                    {% if order.payment_method == 'cod' %}
                        <span class="badge bg-warning text-dark">
                            <i class="bi bi-truck"></i> {{ order.get_payment_method_display }}
                        </span>
                    {% else %}
                        <span class="badge bg-info">
                            <i class="bi bi-bank"></i> {{ order.get_payment_method_display }}
                        </span>
                    {% endif %}
                </p>
                <p><strong>Ngày đặt:</strong><br>{{ order.created_at|date:"d/m/Y H:i" }}</p>
                <p><strong>Ngày cập nhật:</strong><br>{{ order.updated_at|date:"d/m/Y H:i" }}</p>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">Thông tin giao hàng</h5>
            </div>
            <div class="card-body">
                <p><strong>Họ và tên:</strong><br>{{ order.full_name }}</p>
                <p><strong>Email:</strong><br>{{ order.email }}</p>
                <p><strong>Số điện thoại:</strong><br>{{ order.phone }}</p>
                <p><strong>Địa chỉ:</strong><br>{{ order.address|linebreaks }}</p>
            </div>
        </div>
    </div>
</div>

<div class="mt-4">
    <a href="{% url 'order_history' %}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> Quay lại lịch sử đơn hàng
    </a>
</div>
{% endblock %}

